version: 3
projects:
  - name: prod
    dir: terraform/aws/alexgregorydotio-prod
    terraform_version: 1.4.4
    workflow: terragrunt
    autoplan:
      when_modified: # relative to dir defined above
        - "../../modules/aws/**/*.tf"
        - "**/*.tf"
        - "**/*.hcl"

workflows:
  terragrunt:
    plan:
      steps:
      - run: terragrunt plan -input=false
      - run: terragrunt show -json $PLANFILE > $SHOWFILE
